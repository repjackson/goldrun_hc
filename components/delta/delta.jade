template(name='delta')
    with current_model
        .ui.stackable.padded.grid
            .row
                .six.wide.column.scrolling
                    if is_loading
                        .ui.inline.header.pulsing
                            +i name=icon classes='ui avatar image'
                            |loading #{title}...
                    else 
                        .ui.inline.header
                            +i name=icon classes='ui avatar image'
                            | #{title}
                    unless is_loading
                        if currentUser
                            .ui.icon.large.compact.button.add_model_doc(title="Add #{title}")
                                //- +i name='plus' classes='ui avatar image'
                                i.green.plus.large.icon
                        +user_list_toggle key='bookmark_ids' icon='bookmark' label='bookmark' color='red'
                        if is_dev
                            .ui.icon.large.button.edit_model
                                i.large.cog.icon
                                //- +i name='settings'
                                //- | Configure #{plural}
                        // .ui.divider
                        // // each sessions
                        // //     .ui.icon.button.select_session(class=session_selector_class title='select session')
                        // //         i.play.icon
                        if current_delta
                            if is_dev
                                .ui.icon.large.button.print_delta(title='print session doc')
                                    i.code.icon
                            .ui.reset.icon.large.button(title='reload session')
                                //- +i name='refresh' classes='ui avatar image'
                                i.refresh.icon
                            .ui.delete_delta.icon.button(title='delete session')
                                i.trash.icon
                        else
                            .create_delta.ui.large.button(title='new session')
                                i.plus.icon
                                |session
                        if description
                            .ui.segment
                                |#{description}
                        //- if is_dev
                        //-     .ui.input
                        //-         input.import_subreddit(type='text' placeholder='import_subreddit')
                    // |did: #{session_delta_id}
                    div
                    each sorted_facets
                        +facet
                .ten.wide.column
                    .ui.inline.small.header
                        |sort by
                    .ui.compact.menu
                        .ui.simple.dropdown.item
                            |#{current_delta.sort_key}
                            i.dropdown.item
                            .menu
                                each fields
                                    .item.set_sort_key #{title}
                    .ui.small.inline.header direction
                    .ui.compact.button.set_sort_direction
                        |#{current_delta.sort_direction}
                    .ui.inline.small.header
                        |limit
                    .ui.small.input
                        input(type='number' val=limit_amount)
                    .ui.inline.small.header
                        |search
                    .ui.small.input
                        input(type='text' val=search_value)
                    .ui.inline.small.header view
                    .ui.compact.menu
                        .ui.simple.dropdown.item
                            |#{current_delta.sort_by_key}
                            i.dropdown.item
                            .menu
                                .item table 
                                .item list
                                .item icons 
                                .item cards 
                                .item items 
                    //- .ui.stackable.four.column.grid
                    .scrolling    
                        each current_delta.result_ids
                            //- .column
                            +delta_result
            .row 
                .sixteen.wide.column
                    .ui.header calculations
                    .ui.button rerun calculations
                


template(name='facet')
    if filtering_res
        //- .ui.hidden.divider
        .ui.accordion
            .active.title
                if icon
                    //- i.small.icon(class=icon)
                    +i name=icon classes='ui avatar image'   
                .ui.inline.header 
                    if title
                        |#{title}
                    else 
                        |#{key}
                        //- i.dropdown.icon
                .ui.icon.small.transparent.input
                    i.search.icon
                    input.add_filter(type='text')
            .active.content
                //- div
                each filtering_res
                    if name
                        .selector.ui.compact.button.toggle_selection(class=toggle_value_class)
                            strong #{name}
                            if is_admin
                                small #{cal_count} #{count}
                    else
                        .selector.ui.button.toggle_selection(class=toggle_value_class)
                            strong [null]
                            //- small #{cal_count}
                .ui.hidden.divider

template(name='toggle_delta_config')
    if boolean_true
        .ui.active.icon.button.disable_key(title=label)
            i.icon(class=icon)
            // | #{label}
    else
        .ui.icon.button.enable_key(title=label)
            i.icon(class=icon)
            // | #{label}



template(name='delta_result')
    with result 
        //- if template_exists
        //-     +Template.dynamic template=model_template
        //- else
        .ui.result.cloud.fluid.segment(class=loading_class tabindex="0")
            .content
                each fields
                    +Template.dynamic template=view_template 
                .extra
                    if is_model
                        +user_list_toggle key='bookmark_ids' icon='bookmark' label='Bookmark' color='red'
                        a.ui.button.route_model(href="/m/#{slug}")
                            i.sitemap.teal.icon
                            |view model
                        if is_admin
                            a.ui.button.route_model(href="/model/edit/#{_id}")
                                i.edit.blue.icon
                                |edit model
                    //- else
                    //-     if can_edit
                    //-         a.ui.large.icon.button(href="/m/#{current_model.slug}/#{_id}/edit" title='edit')
                    //-             i.pencil.blue.large.icon
                    //-             //- |edit
                    //-     a.ui.icon.large.button(href="/m/#{current_model.slug}/#{_id}/view" title='view')
                    //-         i.right.chevron.yellow.large.icon
                    if _author_id
                        +author_info
                    +creation_info
                    .ui.small.inline.header #{views} views
                        //- i.eye.icon
                        each viewer_usernames
                            .ui.small.basic.label #{this}
                if is_admin
                    +remove_button
            
                    
