template(name='projects')
    .ui.stackable.padded.grid
        .ui.fluid.accordion
            .title
                .ui.inline.header 
                    +i name='line chart' classes='ui avatar image'
                    |project stats
                    .ui.large.label #{project_stats_doc.total_count} total
                    .ui.large.label #{project_stats_doc.complete_count} complete 
                    .ui.large.label #{project_stats_doc.incomplete_count} incomplete 
                    .ui.large.label #{project_stats_doc.total_updates_count} total updates 
                    i.dropdown.icon
            .content
                .ui.grid
                    .three.column.row
                        .column
                            .ui.icon.button.recalc_projects(title='recalculate')
                                i.refresh.icon
                            with project_stats_doc
                                .ui.mini.header projects completed time
                                .ui.mini.header project estimated time
                                .ui.mini.header project monthly completion rate
                        .column
                            +latest_project_updates
                        .column
                            .ui.header 
                                +i name='comments'
                                |latest comments
                            .ui.large.link.bulleted.list
                                each latest_comments
                                    a.active.item(href="/project/#{parent_id}/view") 
                                        strong #{body}
                                    |#{when}
        .row
            .six.wide.column
                .ui.inline.header 
                    +i name='road-worker' classes='ui avatar image'
                    |projects
                .ui.big.icon.button.add_project(title='add project')
                    i.plus.icon
                +cloud filter='project'
            .ten.wide.column.scrolling
                each projects
                    +project_card_template
                    
                    
                    
                    
template(name='project_card_template')
    .ui.fluid.segment
        a.ui.inline.header(href="/project/#{_id}/view")
            if icon
                +i name=icon
            |#{title}
        |!{description}
        |complete
        if complete
            i.large.checkmark.icon(title='complete')
        else
            i.large.circle.outline.icon(title='incomplete')
        |approved
        if approved
            +i name='approval' title='approved'
        else
            i.large.circle.outline.icon(title='not approved')
        +ismall name='tags' classes='ui inline image'
        each tags
            .ui.basic.label #{this}
        div
        .ui.large.basic.label
            |estimated cost #{estimated_cost}
        .ui.large.basic.label
            |actual cost #{actual_cost}
        .ui.large.basic.label
            |related company #{related_company}
        .ui.large.basic.label
            |estimated complete date #{estimated_complete_date}
        .ui.large.basic.label
            |actual complete date #{actual_complete_date}
        .ui.accordion
            .title 
                .ui.inline.header updates
                i.dropdown.icon
            .content
                +activity
        a.ui.button(href="/project/#{_id}/view")
            |view
            i.right.chevron.icon


template(name='project_update_small')
    .ui.small.header #{text}





template(name='project_edit')
    with current_doc
        .ui.stackable.padded.grid
            .three.column.row
                .wide.column 
                    .ui.header 
                        i.pencil.icon
                        |edit project
                    .ui.header
                        if icon
                            +i name=icon
                        |#{title}
                    a.ui.big.fluid.button(href="/project/#{_id}/view" title='save')
                        i.green.checkmark.icon
                        |save
                    +remove_button
                    +icon_edit key='icon' label='icon' direct=true
                    +array_edit key='tags' label='tags' icon='tags' direct=true
                .column 
                    +text_edit key='title' label='title' icon='title' direct=true
                    +image_edit key='image' label='image' icon='image' direct=true
                    +html_edit key='description' label='description' icon='content' direct=true
                .column 
                    +date_edit key='start_date' label='start date' direct=true
                    +date_edit key='end_date_proposed' label='end date (proposed)' direct=true
                    +date_edit key='end_date_actual' label='end date (actual)' direct=true
                    +number_edit key='budget' label='budget' direct=true
                    +number_edit key='end_cost' label='end cost' direct=true
                    +boolean_edit key='contract' label='contract ?' direct=true
                    
                     
template(name='project_view')
    with current_doc
        .ui.stackable.padded.grid
            .row
                .sixteen.wide.column 
                    a.ui.icon.button(href="/projects" title='view projects')
                        +i name='road-worker' classes='ui avatar image'
                    .ui.inline.header
                        if icon
                            +i name=icon
                        +text_view key='title' label='title' direct=true
                    a.ui.big.icon.button(href="/project/#{_id}/edit")
                        i.pencil.icon
            .row
                .four.wide.column 
                    +date_view key='start_date' label='start date' direct=true
                    +date_view key='end_date_proposed' label='end date (proposed)' direct=true
                    +date_view key='end_date_actual' label='end date (actual)' direct=true
                    +number_view key='budget' label='budget' direct=true
                    +number_view key='end_cost' label='end cost' direct=true
                    +boolean_view key='contract' label='contract ?' direct=true
                    +array_view key='tags' label='tags' icon='tags' direct=true
                    +html_view key='description' icon='content' label='description' direct=true
                    +image_view key='image' icon='image' label='image' direct=true
                    +voting_full
                    .ui.small.header #{views} views
                    +viewing
                    +project_files
                .six.wide.column 
                    +activity
                .six.wide.column 
                    +project_change_orders
                    +project_finance
                    +project_photos
                    +comments


template(name='project_files')
    .ui.header 
        +i name='file'
        | documents
    .ui.icon.button.add_file
        i.plus.icon
    .ui.link.list
        each files
            if is_editing
                +text_edit key='title' direct=true
                +pdf_edit key='pdf' direct=true
                +date_edit key='file_date' direct=true
                +array_edit key='tags' direct=true
                +session_edit_icon
                +remove_button
            else
                .item 
                    .header #{title}
                    .content
                        each tags
                            .ui.small.label #{this}
                        |#{file_date}
                        +session_edit_icon
    
    
template(name='project_change_orders')
    .ui.header 
        +i name='change'
        | change orders
    .ui.small.header budget
    .ui.small.header expenses
    
    
template(name='project_finance')
    .ui.header 
        +i name='money'
        |finance
    .ui.small.header budget
    .ui.small.header expenses
    div
    +ismall name='invoice' classes='ui middle aligned image'
    .ui.inline.header
        |payments 
    .ui.small.icon.button.add_payment
        i.plus.icon
    .ui.list
        each payments
            if is_editing
                +text_edit key='recipient' direct=true
                +float_edit key='amount' direct=true
                +date_edit key='payment_date' direct=true
                +session_edit_icon
                +remove_button
            else
                .item 
                    .content #{recipient} $#{amount} #{payment_date}
                        +session_edit_icon
    div
    .ui.inline.header
        |totals
    i.circular.refresh.icon(title='refresh')
    with current_doc
        |$#{payment_total}

template(name='project_photos')
    .ui.header 
        +i name='gallery'
        |photos
    .ui.button add photo


template(name='activity')
    .ui.inline.header 
        +i name='rss'
        |activity    
    .ui.button.add_update
        i.plus.icon
        |update
    .ui.feed
        each updates
            .event
                .label
                    img.ui.avatar.image(src="{{c.url author.kiosk_photo width=300 height=300 gravity='face' crop='fill'}}")
                .content
                    //- .summary
                    a.user #{author.username} 
                    //- |added
                    //- .date posted #{when}
                    | {{ med_date update_date }}
                    .extra.text !{text}
                    .meta
                        +voting_small




template(name='latest_project_updates')
    .ui.header 
        +i name='clock'
        |latest project updates
    .ui.link.list
        each latest_updates
            a.item(href="/project/#{parent_id}/view") 
                +ismall name=project.icon
                .ui.small.inline.header 
                    |#{project.title}: 
                strong #{text}
            |#{when}
