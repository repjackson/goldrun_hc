template(name='reservation_edit')
    with current_doc
        .ui.stackable.padded.grid
            .three.column.row
                .column 
                    a.ui.big.fluid.basic.button(href="/reservation/#{_id}/view" title='save')
                        //- i.checkmark.large.green.icon
                        +i name='submit-progress--v1'        
                        .ui.inline.header save draft     
                    .ui.hidden.divider     
                    .ui.large.fluid.icon.button.cancel_reservation
                        i.ban.icon
                        |cancel
                    .ui.header 
                        strong #{rental.title}
                        small reservation
                    with rental
                        .ui.header $#{hourly_dollars}
                            small /hr
                        .ui.header $#{daily_dollars}
                            small /day
                        +image_view key='image' label='image' direct=true classes='ui rounded image'
                        //- +number_view key='hourly_karma' label='hourly rate (karma)' icon='yin-yang' direct=true
                        //- +number_view key='daily_karma' label='daily rate (karma)' icon='yin-yang' direct=true
                .column 
                    //- a.ui.header(href="/rental/#{rental._id}/view") reserve #{rental.title}
                    //- .ui.fluid.button.reserve_now(class=now_button_class)
                    //-     +i name='present'
                    //-     |reserve now
                    //- unless now
                    //-     +date_edit key='start_date' label='start date' icon='date-from' direct=true
                    //-     +time_edit key='start_time' label='start time' icon='date-to' direct=true
                    +datetime_edit key='start_datetime' label='start datetime' direct=true
                    //- .ui.header 
                    //-     +i name='date-to' classes='ui tiny inline image'
                    //-     |duration
                    +range_edit key='reservation_range' label='range' direct=true
                    //- +boolean_edit key='daily_reservation' label='daily' icon='sun' direct=true
                    //- .ui.compact.button.select_month(class=sel_month_class)
                    //-     +i name='calendar'
                    //-     |month
                    //- .ui.compact.button.select_day(class=sel_day_class)
                    //-     +i name='sun'
                    //-     |day
                    //- .ui.compact.button.select_hour(class=sel_hr_class)
                    //-     +i name='clock'
                    //-     |hour
                    div
                    //- if is_hour
                    //- +number_view key='hourly_dollars' label='hourly rate ($)'
                    //- +number_view key='hourly_karma' label='hourly rate (karma)'
                    //- .ui.button.set_1_hr 1 hr
                    //- +key_value_edit key='hour_duration' value=.5 label='1/2'
                    //- +key_value_edit key='hour_duration' value=1 label='1 hr'
                    //- +key_value_edit key='hour_duration' value=2 label='2 hrs'
                    //- +key_value_edit key='hour_duration' value=3 label='3 hrs'
                    //- +number_edit key='hour_duration' label='other' direct=true
                    //- if is_day 
                    //-     +number_view key='daily_dollars' label='daily rate ($)'
                    //-     //- +number_view key='daily_karma' label='daily rate (karma)'
                    //-     +key_value_edit key='day_duration' value=1 label='1 day'
                    //-     +key_value_edit key='day_duration' value=2 label='2 days'
                    //-     +key_value_edit key='day_duration' value=3 label='3 days'
                    //-     +key_value_edit key='day_duration' value=3 label='other'
                    //-     +number_edit key='day_duration' label='other' direct=true
                    //- if is_month
                    //-     +number_view key='monthly_dollars' label='monthly rate ($)'
                    //-     //- +number_view key='monthly_karma' label='monthly rate (karma)'
                    //-     +key_value_edit key='month_duration' value=1 label='1 month'
                    //-     +key_value_edit key='month_duration' value=2 label='2 months'
                    //-     +key_value_edit key='month_duration' value=3 label='3 months'
                    //-     +key_value_edit key='month_duration' value=3 label='other'
                    //-     +number_edit key='month_duration' label='other' direct=true
                    //- +date_edit key='end_date' label='end date' icon='date-to' direct=true
                    //- +time_edit key='end_time' label='end time' icon='time' direct=true
                    +datetime_edit key='end_datetime' label='end datetime' direct=true
            
                    //- +key_value_edit key='minute_duration' value=30 label='1/2'
                    //- +key_value_edit key='minute_duration' value=60 label='1 hour'
                    //- +key_value_edit key='minute_duration' value=120 label='2 hrs'
                    //- +key_value_edit key='minute_duration' value=180 label='3 hrs'
                    //- +number_edit key='minute_duration' label='minute duration' direct=true
                .column
                    .ui.header.lowercase 
                        small from 
                        |{{cal_time start_datetime}}
                    .ui.header.lowercase 
                        small to
                        |{{cal_time end_datetime}}
                    .ui.header #{hour_duration} hours
                    .ui.fluid.button.calculate_diff
                        |calculate money
                    .ui.header 
                        +i name='money' classes='ui tiny inline image'
                        | #{hour_duration}hrs * $#{rental.hourly_dollars}/hr = $#{estimated_dollars}
                    .ui.header 
                        +i name='payroll'
                        small 50% owner payout 
                        |$#{owner_payout}
                    .ui.header 
                        +i name='get-cash'
                        small 40% handler payout
                        | $#{handler_payout}
                    .ui.header 
                        +i name='tax'
                        small taxes
                        | $#{taxes_payout}
                    .ui.divider
                    .ui.header 
                        small your balance
                        +i name='cheap-2--v1' 
                        |#{currentUser.credit} 
                    .ui.header
                        small reservation cost 
                        |#{estimated_dollars} 
                    .ui.header 
                        small balance after purchase 
                        +i name='cheap-2--v1' 
                        |#{member_balance_after_reservation}
                        
                        
                    unless submitted
                        .ui.big.green.fluid.button.submit_reservation 
                            +i name='paid'        
                            |submit and pay
                    else
                        .ui.header submitted {{ from_now submitted_timestamp }}
                        .ui.orange.fluid.button.unsubmit
                            i.undo.icon
                            |unsubmit
